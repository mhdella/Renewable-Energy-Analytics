  Abstract To integrate solar energy into the electricity grid reliably and efficiently, different forecasting techniques are used to produce forecasts at various forecast horizons using data of different levels of aggregation. For example, power generated by distributed photovoltaics (PV) can be disaggregated in a geographical hierarchy into transmission zones, distribution nodes, PV plants, subsystems and inverters; forecasts are required at all of these levels to facilitate different power system operations and power plant management. Due to the different information sets visible to different players in the hierarchy, such as PV plant owners and independent system operators, the forecasts produced at different aggregation levels are often not optimal. Furthermore, these forecasts are aggregate inconsistent, i.e., forecasts made using data collected at lower levels do not add up exactly to the forecasts made using higher level data. In this paper, the state-of-the-art forecast reconciliation techniques are explored. By minimizing the trace of forecast error covariance matrix, the base forecasts obtained across the hierarchy can be optimally reconciled. The reconciled forecasts not only aggregate consistently, and thus lead to collaborative decision making, but also improve the base forecasts at each level significantly. The merit of the reconciliation framework goes to the fact that it does not require any additional information other than those base forecasts. Furthermore, forecast improvements are independent of the base forecasting methods. In other words, once the base forecasts are generated with our favorite methods, the reconciliation will most likely improve those forecasts further. The reconciliation techniques can be applied to a variety of hierarchies with different forecast horizons. The empirical part of this work considers two examples, namely, an NWP-based day-ahead forecast reconciliation over 318 simulated PV plants in the state of California, and a spatio-temporal statistical 1-min-ahead forecast reconciliation over 17 irradiance sensors on the Oahu Island, Hawaii. It is shown that reconciliation benefits both the gird operators and PV system owners by bringing more accurate forecasts, and thus motivates information sharing in an electricity grid.   Keywords Forecasting  Hierarchical reconciliation  Numerical weather prediction  Spatio-temporal forecasting    1 Introduction Grid penetration level of solar energy increases rapidly, especially in locations with rich solar resources, such as the states of California and Hawaii. The state of California government has established a statewide goal to significantly mitigate the greenhouse gas emissions through an aggressive renewables portfolio standard (RPS). The RPS which began in 2002, requires 33% and 50% renewable energy integration in 2020 and 2030, respectively. Due to their extreme dependency to the weather condition causing high variabilities and uncertainties, such aggressive increase in the penetration of renewable energy resources including solar energy is prone to diminishing the power system reliability remarkably. To prevent these adverse effects of integration of high penetrations of renewable energy in electric grid, power system operators are urged to develop reliable solutions to address high variabilities of such energy resources. Making forecasts at different forecast horizons using data with different time granularities has been a key issue in integrating variable solar energy into electricity grids. A recent study by the National Renewable Energy Laboratory (NREL) on the impact of improved solar forecast on power system operation in Independent System Operator–New England (Martínez-Anido et al., 2014 ) shows that a 25% PV penetration would reduce the net generation cost in ISO-NE by 22.9% if the solar forecast is perfect. However, the cost reduction would be as low as 12.3% with the current forecast techniques, and a 25% improvement in solar forecast would lead to an additional 1.56% ($46.5 M) reduction in net generation cost. From an electricity grid operator’s point of view, the above-mentioned forecasts are associated with and used in various power system operations. Makarov et al. (2011)  provided an overview of California independent system operator (CAISO)’s operating practice. The CAISO operating time lines can be grouped into three schedules, namely, generation schedule in the day-ahead market (DAM), schedule in the real-time market (RTM) and schedule for real-time regulation process. In the DAM, hourly day-ahead forecasts are generated (for both load and renewable energy generation) at 10 a.m.  the day prior to the operating day. In the real-time market, two types of forecasts are needed: (1) 5 h of 15 min forecasts are performed at 75 min before the actual beginning of an operating hour for short-term unit commitment, and (2) 65 min of 5 min forecasts are needed at 7.5 min before the operating hour for real-time economic dispatch. Lastly, the real-time regulation process requires a 4 s forecast. For all these operation timescales practiced by CAISO, the spatial forecast accuracy benefits CAISO’s power market clearing process by providing more details on the power injected by solar panels to different buses of the power grid. As of now, CAISO just uses the forecasts of renewable energy resources from its different electric regions to run its market clearing process. As the position of the renewable energy resources and their individual power injection to the grid has significant effect on power loss and voltage profiles, any increase in the geographic resolution of such forecasts will enable the market operator to consider more details in its unit commitment and optimal power flow optimization problems. This combined with any enhancements of forecast accuracy will obviously improve the reliability of the market results for the real operation of the power system and will reduce the difference between the DAM and RTM results due to forecast errors. Therefore, the costs associated with dispatching expensive, fast-response generators such as gas turbines in order to fill the gap between DAM and RTM results will be decreased. Further, with the definition of microgrids and virtual power plants (VPP) managed by aggregators and private owners to maximize their benefits or minimize their operation costs, any forecast error will deviate the results of their optimization problem for bidding to the market from what is the their best action to take if the forecast is perfect. Similarly, such deviations make the aggregators and owners to buy more expensive power from RTM in case of under-forecasting and sell their excess power with lower price to RTM in case of over-forecasting. Thus, any improvement in the accuracy of spatial solar forecasts will benefits the microgrids and VPPs by (1) reducing the difference between their DAM and bidding results and (2) enhancing their optimization models to consider the effects of the power networks more precisely, in terms of voltage profile and power loss. In the recent years, solar energy forecasting techniques have advanced unprecedentedly. The bulk of the literature focuses on developing a particular forecasting approach that is known as “most appropriate” for a forecast horizon. For examples, numerical weather prediction (NWP) is usually developed and validated at a day-ahead forecast horizon (e.g., Perez et al., 2013 ); satellite data based forecasts are usually performed at an hourly resolution due to the temporal resolution of satellite images (e.g., Voyant et al., 2014 ); sky camera based approaches (e.g., Yang et al., 2014 ) perform best at a forecast horizon up to 15 min; correlating measurements from a sufficiently densed sensor network (e.g., Aryaputera et al., 2015b ) can forecast accurately for a few seconds to a minute; and machine learning and statistical forecasting techniques are commonly used in intra-hour and hourly forecasting (e.g., Pedro and Coimbra, 2012 ). For a detailed association of techniques and horizons, the readers are referred to the review by Inman et al. (2013) . In addition, the two recent review papers also provide valuable summaries on the state-of-the-art solar forecasting techniques (Antonanzas et al., 2016; Raza et al., 2016 ). While the association among forecasting method, spatial scale and forecast horizon has been well understood, the constraint known as “aggregate consistency” is yet to be studied in the solar forecasting context. The solar power injection into an electricity grid can be modeled as a hierarchy, as shown in Fig. 1  . The total solar power at any instance in an interconnection can be considered as the sum of the smaller power contributions from each transmission zone, distribution node, power plant and inverter in that interconnection. As mentioned earlier, different players (such as the power system operators and solar power plant owners) in a power system hierarchy produce their own forecasts for various operational needs. While the power in a hierarchy sums up naturally, the forecasts need to be aggregate consistent as well. Nevertheless, the lower level forecasts usually do not add up exactly to the forecasts made at higher levels, due to the different data and forecast methods used by different players in the hierarchy. The disagreement in the forecast numbers hinders power system operations by posing an apparent question: which number should be used? The primary goal of this paper is thus to address the aggregate inconsistency during solar forecasting. The commonly used methods to produce aggregate consistent forecasts include bottom-up, top-down and middle-out approaches (Athanasopoulos et al., 2009 ). Bottom-up approach only requires the bottom-level forecasts; the forecasts at upper levels are obtained by summing these bottom-level forecasts. Top-down approach on the other hand starts from making the top-level forecasts; the forecasts at lower levels are then assigned proportionally based on the system size or other features. Lastly, as the name suggests, middle-out approach makes forecasts at a middle level; the upper or lower level forecasts are obtained by aggregate or disaggregate the middle-level forecasts, respectively. Although these methods seem trivial, they are not optimal for hierarchical solar forecasting due to two main reasons. Firstly, it is difficult to transfer forecasts produced at a particular level to other levels. For example, power of distributed PV plants is primarily influenced by moving clouds, only knowing the system size is insufficient to perform the top-down approach. Secondly, different players in the hierarchy are exposed to different information sets that are unobservable by others, but are known to be able to improve local forecasts. For example, power grid operators have historical net load information, which is unobservable by PV plant owners. In view of the above discussion, this paper considers a so-called “optimal reconciliation” technique. This technique considers the independently-made forecasts in a hierarchy simultaneously. By minimizing the trace of forecast error covariance matrix, the forecasts obtained across the hierarchy are optimally reconciled. On this point, reconciliation should be thought of more as a technique that revises forecasts than a forecasting method. Revising forecasts, also known as forecast post-processing or reforecast, has been studied extensively in solar engineering. Most of the works in the literature focus on revising NWP-based methods due to their known bias (e.g., Verzijlbergh et al., 2015; Pierro et al., 2015; Diagne et al., 2014; Mathiesen and Kleissl, 2011 ); the technique used in these works is model output statistics (MOS). Besides MOS, other innovations such as the artificial neural network-based reforecast models are also available (Chu et al., 2015 ). The reconciliation techniques used in this work are conceptually different from the others, however, with no exception, they improve forecast accuracy. Furthermore, as shown in the later sections, improvement on accuracy can be observed on all levels of a hierarchy, and is independent of the forecasting method and forecast horizon. In this paper, a total of four state-of-the-art forecast reconciliation techniques are explored. Due to the aggregate consistency of the reconciled forecasts, these forecast can facilitate collaborative decision making during power system operation management. The merit of the reconciliation framework goes to the fact that it does not require any additional information other than those base forecasts. In other words, the forecasts at individual levels can be generated with a best-known promising method, the reconciliation will most likely improve those forecasts further. The remaining part of the paper is organized as follows: Section 2  formulates the hierarchical reconciliations. Two case studies, namely, a day-ahead forecast example and a minute-ahead forecast example, are shown in Sections 3 and 4 , respectively. Conclusions follow at the end.  2 The hierarchical reconciliation framework The hierarchical reconciliation framework involves two types of forecasts, namely, the base forecasts  and reconciled forecasts . The base forecasts refer to the forecasts made at each series at all levels in a hierarchy. These forecasts can be generated by any of those favorable techniques mentioned in Section 1 ; and the forecasting techniques for each series need not be the same. On the other hand, the reconciliation step in hierarchical forecasting does not work with the observation data directly, instead it manipulates the base forecasts and makes them aggregate consistent. As the information across the hierarchy is considered simultaneously, the reconciliation most likely improves the base forecasts. To illustrate the concept of hierarchical time series, we consider a toy example of a two-level hierarchy. Suppose that in a transmission zone (referred to as level 0, top level or L  0     ), there are two UPV plants (level 1, middle level or L  1     ), A and B. Each UPV plant has three central inverters (level 2, bottom level or L  2     ), namely, AA, AB, AC, BA, BB, and BC. In this example, there are thus a total of 9 time series. Let Y  i , t      be a column vector of all the observations in level L  i      at time t , the hierarchical relationship among these observations can be written as:(1) Y  t   = ( Y  0 , t   , Y  1 , t  ⊤   , Y  2 , t  ⊤   )  ⊤   = SY  2 , t   ,     where S    is known as the summing matrix, which has entries of either 0 or 1. The above equation can be written equivalently as:(2) Y  0 , t     Y  A , t     Y  B , t     Y  AA , t     Y  AB , t     Y  AC , t     Y  BA , t     Y  BB , t     Y  BC , t         = 1  1  1  1  1  1   1  1  1  0  0  0   0  0  0  1  1  1   1  0  0  0  0  0   0  1  0  0  0  0   0  0  1  0  0  0   0  0  0  1  0  0   0  0  0  0  1  0   0  0  0  0  0  1       Y  AA , t     Y  AB , t     Y  AC , t     Y  BA , t     Y  BB , t     Y  BC , t         .    In general, if there are more than two levels, Eq. (1)  can be written as:(3) Y  t   = Sb  t   ,     where b  t      is the column vector containing the most disaggregated (bottom level) values at time t . 2.1 The regression representation of forecast reconciliation Although the PV-generated power observations at the bottom level naturally sum up to the power observations at higher levels, it is however very unlikely that the forecasts are also aggregate consistent. To deal with this aggregate inconsistency, Hyndman et al. (2011) and Athanasopoulos et al. (2009)  considered a regression setup:(4) Y  ̂    t   ( h ) = S β  t   ( h ) + ε  h   ,     where ε  h      is the reconciliation error with zero mean and unknown covariance Σ  h   ; β  t   ( h ) = E ( b  t + h   | Y  1   , … , Y  t   )    is the unknown mean of bottom-level values; and Y  ̂    t   ( h )    is the column vector of all the h -step-ahead base forecasts made at time t . If Σ  h      is known, the generalized least squares (GLS) estimator of β  t   ( h )   : (5) β  t  GLS   ( h ) = ( S  ⊤   Σ  h  †   S )  - 1   S  ⊤   Σ  h  †   Y  ̂    t   ( h ) ,     where Σ  h  †      is a generalized inverse of Σ  h     , would be the best linear unbiased estimator. In this case, the reconciled forecasts, Y  ̃    t   ( h )   , are given as:(6) Y  ̃    t   ( h ) = S β  t  GLS   ( h ) .     However, as shown by Wickramasuriya et al. (2015) , Σ  h      is usually not known and is not identifiable. Consequently, a series of alternative estimators were proposed.  2.2 Reconciliation techniques Most of the alternative estimators can be generalized by an estimator called the minimum trace (MinT) estimator (Wickramasuriya et al., 2015 ). As the name suggests, the MinT estimator minimizes the sum of variances of the h -step-ahead reconciled forecast errors, i.e.:(7) min { trace [ V ( e  ̃    t   ( h ) ) ] } ,     where(8) e  ̃    t   ( h ) = Y  t + h   - Y  ̃    t   ( h ) .     It should be noted that e  ̃    t   ( h )    and the earlier ε  h      are different, as ε  h      is originated from the aggregate inconsistency. Following Theorem 1 in Wickramasuriya et al. (2015) , the MinT estimator is give as:(9) β  t  MinT   ( h ) = ( S  ⊤   W  h  - 1   S )  - 1   S  ⊤   W  h  - 1   Y  ̂    t   ( h ) ,     where W  h      is the covariance matrix of the h -step-ahead base forecast errors, given by:(10) e  ̂    t   ( h ) = Y  t + h   - Y  ̂    t   ( h ) .      Although matrix W  h      does not suffer from a lack of identification, in practice, it is still hard to estimate (Wickramasuriya et al., 2015 ). In this paper, we consider 4 simplified estimators.1. The ordinary least squares (OLS) estimator assumes W  h   = k  h   I   , where k  h   > 0    and I    is an identity matrix. β  t  MinT   ( h )    is simplified to:(11) β  t  OLS   ( h ) = ( S  ⊤   S )  - 1   S  ⊤   Y  ̂    t   ( h ) .     This estimator was proposed by Hyndman et al. (2011) .  2. The weighted least squares (WLS) approach considers W  h   = k  h   W  ̂    1 , D     , where W  ̂    1 , D      is diagonal matrix made of the sample variances of historical base forecast errors. β  t  MinT   ( h )    is simplified to:(12) β  t  WLS   ( h ) = ( S  ⊤   W  ̂    1 , D  - 1   S )  - 1   S  ⊤   W  ̂    1 , D  - 1   Y  ̂    t   ( h ) .       3. The third estimator, which we call HLS1 HLS is the acronym for weighted least square using weights derived from the hierarchical structure. The naming is used to differentiate the method with WLS. We also note that this should not be taken as an “accepted” name for the method.  1   in this paper, is also a WLS estimator. Instead of considering W  ̂    1 , D     , this estimator uses weights that are purely based on the structure of the hierarchy, i.e., W  h   = k  h   Λ   , where Λ = diag ( S 1 )    and 1    is a column vector of 1s. β  t  MinT   ( h )    is simplified to:(13) β  t  HLS   ( h ) = ( S  ⊤   Λ  - 1   S )  - 1   S  ⊤   Λ  - 1   Y  ̂    t   ( h ) .     This estimator was proposed by Athanasopoulos et al. (2015) . Its advantage over OLS is that HLS does not assume equivariant forecast errors across all levels of hierarchy.  4. The fourth estimator is the closest approximate of MinT estimator, where W  h   = k  h   W  ̂    1     . W  ̂    1      is the 1-step-ahead base forecast error covariance. We write:(14) β  t  MinT ∗   ( h ) = ( S  ⊤   W  ̂    1  - 1   S )  - 1   S  ⊤   W  ̂    1  - 1   Y  ̂    t   ( h ) .     The matrix W  ̂    1      can be estimated using the sample covariance. However, this may not be a good estimate when the total number of time series in the hierarchy is greater than the sample size (Wickramasuriya et al., 2015 ). In such case, the shrinkage estimator(15) W  ̂    1 , D  ∗   = λ  D   W  ̂    1 , D   + ( 1 - λ  D   ) W  ̂    1       can be used. See Schäfer and Strimmer (2005)  for the computation of λ  D     .    Using any of the above four estimators, the reconciled forecasts can be obtained by replacing β  t  GLS   ( h )    in Eq. (6)  with the respective estimator. Among the four estimators, β  t  OLS   ( h )    and β  t  HLS   ( h )    are independent of the error covariance. On the other hand, using β  t  WLS   ( h )    or β  t  MinT ∗   ( h )    still requires the estimation of error covariance. When the base forecasts are produced with time series forecasting methods, such as exponential smoothing (ETS) state space and seasonal autoregressive integrated moving average (SARIMA) models, W  ̂    1      can be readily computed from the in-sample 1-step-ahead forecast errors (Hyndman et al., 2008; Box et al., 1994 ). However, if the base forecasts are generated by other methods, such as the NWP-based methods, it is not possible to obtain W  ̂    1      using the in-sample approach. Fortunately, when we assume the error distribution in each step to be independent and identically distributed (i.i.d.), we can use empirical error covariance matrix computed from historical forecasts to replace W  ̂    1     . In later sections, we demonstrate that the i.i.d. assumption is reasonable. The regression solutions presented in Eqs. (11)–(15)  can be easily appreciated. Nevertheless, due to the sparse summing matrix and (possibly) unbalanced hierarchies, the computation of the matrices’ inverse is not straightforward. Fortunately, the computational pitfalls and remedies are discussed in great details by Hyndman and coworkers (Hyndman et al., 2011, 2016a; Athanasopoulos et al., 2015 ). The algebra and statistical manipulations are implemented in the R package hts  (Hyndman et al., 2016b ); our implementation is built upon the package.   3 Day-ahead forecast reconciliation In this case study, hierarchical reconciliation techniques are applied to day-ahead PV power output forecasts. Generally speaking, NWP-based techniques are favorable for day-ahead forecasts. Nevertheless, when PV output power is sufficiently aggregated and its transient becomes less variable, seasonal time series models, such as ETS and SARIMA models, can also be considered appropriate and produce reliable results (Aryaputera et al., 2015a ). For such reasons, we use NWP forecasts as the bottom-level base forecasts and use ETS to generate base forecasts for the remaining levels. 3.1 Data and NWP forecasts on L  2      The western wind and solar integration study (WWSIS) is a three-phase project conducted by NREL to explore the operational impact of large amounts of wind and solar energy penetration into the power system operated by the WestConnect, a group of transmission providers that are working collaboratively in the western United States (GE Energy, 2010; Lew et al., 2013; Miller et al., 2014 ). The solar power dataset used in the project, namely, solar power data for integration studies (SPDIS), is freely available at http://www.nrel.gov/grid/solar-power-data.html . The SPDIS dataset consists of 1 year of 5 min solar power from simulated PV plants across United States. There are two types of PV plants that were modeled: (1) utility-scale PV plants were modeled at locations with high solar resource and connected to the nearest transmission buses, and (2) distributed PV plants were modeled at the population centers. The simulated power data is based on the satellite-derived irradiance data from the SolarAnywhere database; the sub-hourly data were then synthetically generated from these irradiance data using the algorithm described by Hummon et al. (2012) . Besides the 5 min PV power data, the day-ahead forecasts (hourly resolution) at each power plant are also available. These forecasts were generated by 3TIER based on their NWP simulation (3TIER, 2010 ). Although no statistical error adjustment (such as the MOS used by, Mathiesen and Kleissl, 2011 ) was made, these forecasts were used in phase I and II of WWSIS; the validity of the day-ahead forecasts is thus assumed at once. To demonstrate the hierarchical reconciliation techniques, data from 405 plants in California are used. Among these 405 plants, some plants adopt a fixed orientation design, while others use a tracking design. As there are significant differences in power output transients of these two types of systems, a time series clustering algorithm is used to separate the fixed orientation and tracking PV plants in Appendix A . After the clustering, the sizes and locations of 318 fixed orientation systems are shown in Fig. 2  (a); the remaining tracking systems are disregarded in this paper. At this point, the 5 min data and day-ahead forecasts are normalized to values between 0 and 1, by dividing the raw data with the size of the systems. Ideally, if the transmission bus locations were known, we could assign PV systems to their nearest bus for reconciliation. However, these power system data are highly sensitive and are not available. For such reason, we hypothetically define a two-level hierarchical structure. We assume 5 buses in California and use a spatial k-means clustering algorithm to cluster the PV systems; the clusters are shown in Fig. 2 (b). With this setup, we have 5 L  1      time series and 318 L  2      time series.  3.2 ETS forecasts on L  0      and L  1      To generate the base forecasts at L  0      and L  1     , we consider ETS. ETS models a time series using three components, namely, the seasonal, trend and error components. The trend component can be further modeled as a level component and a growth component. The state space formulation of ETS (Hyndman et al., 2002, 2008 ) is well-documented in the literature, and the method has been adopted to forecast solar irradiance time series numerous times (e.g. Yang et al., 2015b; Dong et al., 2013, 2014 ). The 5 min normalized PV power output data is first aggregated temporally into hourly time series. According to the hierarchy defined earlier, these bottom-level time series are then aggregated into L  0      and L  1      series. For each series, rolling forecasts are made using ETS. The model is first fitted using the first 7 days of data, namely, from 2006 Jan 1 to Jan 7. As the data is hourly, our forecast horizon is set to be 24. Once the forecasts of Jan 8 are made, we refit another ETS model using the measured data between Jan 2 to Jan 8, and produce forecasts for Jan 9. The process iterates until the forecasts for 2006 Dec 31 are made. As model selection and fitting are required for each day and each time series, parallel computing is used. The R code for this section, as well as for other sections, is provided as supplementary materials  (see Appendix B  for instructions).  3.3 Reconciliation results for day-ahead forecasts At this stage, true out-of-sample forecasts have been made available for all series in the hierarchy; the night time forecasts are subsequently removed. The measured data is not needed during reconciliation, however, it will again be used during the forecast error computation and analysis. As previously mentioned, OLS and HLS reconciliations do not require the error covariance. However, the covariance estimate is needed for WLS and MinT∗. For such reason, we use 50% of our true out-of-sample forecasts2 We also used 20%, 30% and 40%; all results and discussions shown in the later part of this paper are valid for these cases.  2   to compute the error covariance; the remaining forecasts are used for reconciliation validation. It is useful to evaluate the reconciled forecasts, Y  ̃    t   ( 1 ) , … , Y  ̃    t   ( 24 )   , on both levels. In the forecasting literature, it is common to evaluate forecasts at different forecast horizons (e.g., Hyndman et al., 2011 ). In this paper, we only evaluate the overall forecast accuracy for all h , at an hourly resolution, owing to the fact that day-ahead PV generation forecast is only performed once per day. Nevertheless, it is hypothesized that the errors during the mid-day period will be higher due to the larger swing in PV power. On this point, another interesting study could be thought of, namely, temporal hierarchy in forecasts. When the new hourly forecasts are made during the actual operation day using more updated data, how do we address the inconsistency between the new forecasts and the day-ahead forecasts obtained earlier? We hope to address this in a future study. 3.3.1 Errors on L  1      Four reconciliation techniques, namely, OLS, WLS, HLS and MinT∗, are used to reconcile the forecasts using Eq. (6)  using the respective β  t     . On top of that, the bottom-up approach (BU) is implemented as a benchmark. The reconciled forecast accuracies in terms of normalized root mean square error (nRMSE) and normalized mean bias error (nMBE) are depicted in Table 1  . The rows correspond to the early defined transmission zones (see Fig. 2 ). It is observed that in terms of nMBE, applying ETS directly to the aggregated time series produces the most unbiased forecasts. This indicates that the NWP based methods create negative biases (over-prediction); earlier reports on such observation include (Mathiesen and Kleissl, 2011 ). Nevertheless, HLS and MinT∗ are able to eliminate some of the high biases seen in BU and WLS. It is believed that when MOS is applied to these results (or reconcile the MOS corrected forecasts) can lead to better results in both nMBE and nRMSE. In terms of nRMSE, BU performs worse than ETS due to the high variability in the disaggregated series. Therefore, when geographical smoothing effect is apparent, instead of summing up the NWP forecasts (the BU approach), using time series models directly on higher level series can be more reliable. It is also observed that HLS and MinT∗ outperform the rest with significant margins. Considering that no additional information other than base forecasts is used during the reconciliation, such improvement in forecasts is encourging. Although HLS has a lower overall nRMSE than MinT∗, it does not dominate MinT∗ on L  1     . To advise the preferred reconciliation technique, we evaluate L  2      forecasts next.  3.3.2 Errors on L  2      Similar to the L  1      forecasts, after the reconciliation, each technique yields 318 sets of forecasts. By comparing these forecasts to the measured data at L  2     , 318 nRMSE values can be computed for each reconciliation techniques. These nRMSEs (in percentage) are plotted against each other in Fig. 3  , occupying the lower triangular positions. In addition, the plots for the L  2      base forecasts, i.e., the forecasts generated by 3TIER, are also shown. The distributions of nRMSE are shown in the diagonal entries of Fig. 3 . In the scatter plots, if a point is below the identity line, it reflects that the method on the y -axis generates a lower nRMSE value at that PV system than the method on the x -axis. Therefore, it can be observed that MinT∗ and HLS have, in general, lower nRMSEs than the other methods. To further quantify and compare the errors, Diebold–Mariano test (Diebold and Mariano, 1995 ), which statistically compares the predictive accuracies, is considered. This test is widely used and has been considered to compare different radiation models (Yang, 2016 ), hierarchical tourism demand (Athanasopoulos et al., 2009 ) and hierarchical fast moving consumer goods demand (Yang et al., 2015a ). The null hypothesis of this test is that the mean of the loss differential is 0. In our particular case, it is thought appropriate to use a squared loss function, i.e., g e  ̃    t      = e  ̃    t      2     , where e  ̃    t      is the scalar version of the reconciled forecast error defined in Eq. (8) . This implies that DM test will be used on each L  2      series, between each pair of techniques. Using the above loss function, we have H  0   : E ( d ) = 0   , where d ≡ g e  ̃    t  ( M )      - g e  ̃    t  ( M  ′   )      ; M    and M  ′      denote a pair of techniques. As either technique M    or technique M  ′      could be better, a two-sided alternative is used, H  1   : E ( d )  ≠  0   . The DM test results are shown in the upper triangular entries of Fig. 3 . The numbers indicate the percentage of instances (out of 318 cases) the DM test statistics falls in the lower or upper 2.5% tail of a standard normal distribution. For example, the plot on the top-right corner shows that MinT∗ is statistically better than 3TIER 80.19% of times. From the DM test results, it is surprising the WLS outperforms 3TIER at almost every (99.69%) system, despite that the earlier scatter plot (3rd row, 1st column) shows high similarity between the nRMSEs. This indicates that the WLS is consistently (or systematically) better than 3TIER by a very small margin. Although the WLS’s improvement over 3TIER forecasts is statistically significant, WLS underperforms MinT∗, HLS and even OLS; it is thus not recommended to use WLS. Instead, MinT∗ is recommended as it outperforms the other methods most of the times and marginally outperforms HLS (39.94% better, 20.44% worse) on L  2     .    4 Minute-ahead forecast reconciliation In this section, a 1-min-ahead forecast reconciliation case study is presented. Various intra-hour power system operations are reviewed in Section 1 . The reason that we demonstrate 1-min-ahead forecast instead of 5-min-ahead or 15-min-ahead forecast is due to the limitation in the dataset (see below). When spatio-temporal statistical forecasting is used, the spatial scale of the monitoring network is of great importance. It has been shown that the forecast skill, a measure of goodness of forecast against persistence, peaks at a 1 min horizon for our current dataset (Aryaputera et al., 2015b; Yang et al., 2015c ). Nevertheless, the forecasting exercise herein presented can be translated to forecasts that facilitate real-time economic dispatch and real-time regulation process, when a network of suitable scale is available. On this point, the importance of solar irradiance monitoring network design (e.g., Yang and Chen, 2015; Yang and Reindl, 2015 ) is emphasized. 4.1 Data NREL installed 17 irradiance sensors on Oahu Island, Hawaii, in March 2010, to perform a grid integration study under the effect of trade winds and rapid irradiance variation caused by moving clouds. This sensor network covers an area of approximately 1 km × 1.2 km with the inter-station distance varying from 100 to 1125 m. The original data was sampled at 1s intervals; we average these raw data to a 1-min resolution. The raw data is freely available at http://www.nrel.gov/midc/oahu_archive/ . R code to aggregate the raw data had been made available previously (Yang et al., 2015c ). Sensor locations in the Oahu network are shown in Fig. 4  . Given the geographical proximity, these irradiance sensors can be thought of as a representation of power output measurable at the inverter level. Furthermore, we hypothetically group these “inverters” into 4 PV systems, represented by the different colors used in Fig. 4 . Thus, we have a two-level hierarchy with 4 L  1      and 17 L  2      series. As mentioned earlier, this island is dominated by trade winds oriented from an angle of approximately 60°. For such reason, many sensor pairs can be found at positions along that direction. In a previous solar irradiance variability study carried out by Hinkelman (2013) , 13 days dominated by broken cloud were identified. The exact days were subsequently used to develop and evaluate forecasting methods (Aryaputera et al., 2015b; Yang et al., 2015c ). In contrast to day-ahead forecasting which looks several days into the history, intra-hour forecasting relies mostly, if not completely, on data collected on the actual operation day to make inference. Yang et al. (2015c)  used the first 20% of data (after a 80°    zenith angle filter) to develop a (lasso) regression model for each of those 13 days. Thus, under this forecast setting, each day can be considered as an independent dataset. To demonstrate the forecast reconciliation techniques, data from 2010 Sep 5 is used. In this case study, the exact method used in (Yang et al., 2015c ), namely, spatio-temporal lasso regression, is used to generate the forecasts on L  2     . ETS is used for L  0      and L  1      forecasts.  4.2 Forecast L  2      using the lasso The lasso (least absolute shrinkage and selection operator) regression (Tibshirani, 1996, 2011 ) is a variable shrinkage and selection method for linear regression. Given data ( x  i   , y  i   ) , i = 1 , … , t   , where x  i   = ( x  i 1   , … , x  ip   )  ⊤      are the p  predictors and y  i      are the responses, the linear regression:(16) y  i   = β  0   + ∑  j = 1  p    β  j   x  ij       can be estimated via estimator:(17) β  ̂   = argmin  β    ∑  i = 1  t    y  i   - β  0   - ∑  j = 1  p    β  j   x  ij      2   + λ ∑  j = 1  p    | β  j   |    ,     where β = ( β  0   , β  1   , … , β  p   )  ⊤      and λ    is the tuning parameter regulating the strength of the ℓ  1      penalty. Parameter λ    can be estimated through k -fold cross validation. Once β  ̂      is obtained, the response can be readily estimated with any new x  i     , such as i = t + 1   . In our scenario, y  i      is the irradiance measurements at the focal location, and x  i      are the time series collected at the neighboring locations with various time lags, as well as the lagged time series at the focal location. A thorough validation was made previously using the lasso on our present dataset. Yang et al. (2015c)  considered using different predictor sets (variations in both spatial predictors and temporal predictors) with known or unknown wind information, validated the method for different forecast horizons and on different days, and benchmarked the results with several alternative forecasting methods (such as ETS, ARIMA and OLS3 Note that the OLS here does not refer to the OLS reconciliation, instead, it refers to the OLS estimator for Eq. (16) .  3  ). In this paper, the exact approach (20% fitting data from the complete network, known wind information) described in Section 3.5 of (Yang et al., 2015c ) is used; we refer the readers to the original publication for the details. Lasso is a regression method; it thus allows the computation of in-sample error. Therefore, all test data (80%) can be used in true out-of-sample reconciled forecast evaluation.  4.3 Forecast L  0      and L  1      using ETS ETS state space models consist of 30 variations, in which 20 are seasonal models (Hyndman et al., 2008 ). We considered all 30 models in Section 3.2  during our model selection process. However, in this section, only non-seasonal ETS models are considered and used during model selection, to generate forecasts on L  0      and L  1     . The reason that we only consider the non-seasonal models is that the data used in day-ahead forecasting has a natural period of 24 h, where as the periodicity in the intra-day data cannot be established. Although in the literature, there have been works that use a Fourier trend model to model an intra-day time series and thus estimate the intra-day periodicity (Dong et al., 2013 ), the method in general requires data from more than 1 day. We use 20% of the data to select and fit an ETS model for each series on L  0      and L  1     . As ETS models are time series models, the base forecast error can again be estimated from the in-sample errors. The same ETS models are used throughout the remaining 80% of the data.  4.4 Reconciliation results for minute-ahead forecasts Similar to the day-ahead forecasting example shown earlier, the nRMSE and nMBE of L  1      forecasts are shown in Table 2  . With little surprise, directly applying ETS on the aggregated time series leads to the smallest nMBE. The reconciled forecasts has higher nMBE than ETS due to the well-known bias–variance tradeoff in lasso and the intricate error propagation in each reconciliation method. Nevertheless, all of these nMBE are less than 2% and can be considered as acceptable. The nRMSE table reveals that, unlike the previous day-ahead example, bottom-up approach performs better than ETS. This is owing to the high accuracy of lasso forecasting. In situations where the higher level series still carries considerably large amount of variabilities, aggregating the accurate bottom-level forecasts is more preferable than forecasting the aggregated series directly. Among all the reconciliation techniques, MinT∗ has the lowest overall nRMSE, which again demonstrates the advantage of optimally reconciling the forecasts. The improvements in L  1      forecasts are beneficial to grid operators. However, reconciliation requires bottom-level information which is usually unobservable to grid operators. To motivate the system owners to share their forecasts, if not sharing the complete power information, we consider the reconciled forecast accuracy on L  2     . Table 3   shows the nRMSE (with nMBE omitted) on L  2      in the minute-ahead case study. It can be seen that the overall nRMSE for MinT∗ is lower than that of lasso. This improvement in errors relates to the various benefits that can be gained by the system owners, including better inverter control, better storage management and better bidding decisions. It is hypothesized that the benefits to the individuals would increase when more players participate in forecast sharing.   5 Conclusions Total solar power generated in an electricity grid is modeled using a hierarchy. Solar power forecasts can be made with different methods at various levels in the hierarchy. As these forecasts are likely to be generated independently using different data and information sets, the concept of aggregate consistency needs to be introduced. By reconciling the forecasts across the hierarchy, aggregate consistent forecasts are obtained. A total of four reconciliations methods (OLS, WLS, HLS and MinT∗), which differ only by the ways to approximate the covariance of the h -step-ahead base forecast error, are tested and evaluated through two case studies. In both case studies, the base forecasts are generated using carefully selected state-of-the-art methods including NWP (3TIER, 2010 ), lasso (Yang et al., 2015c ), and exponential smoothing (Aryaputera et al., 2015a ); reconciled forecasts are then shown to outperform the base forecasts by significant margins, with MinT∗ being the overall best method. The forecast accuracy improvements as a result of reconciliation are likely to be observed on all levels of a hierarchy, regardless of the structure of the hierarchy. The reconciliation techniques can be used in a variety of applications. For example, an electricity generation company may own several geographically distributed PV power plants, better forecast on the total generation from these plants may be beneficial to the company during bidding. While it is possible to reconcile forecasts through hierarchies with centralized information (accessible to a single player), reconciling other hierarchies that involve multiple players may be considered as impractical, as the reconciliation requires information sharing among the players. On this point, we digress to discuss the information sharing in a supply chain. Although it is well understood that coordination across an entire supply chain creates win-win situations for all players in that supply chain, such coordination is often limited by the nature of the business-driven environment where strategic information (such as promotional campaign and pricing) is proprietary (Özer et al., 2011, 2014; Ali and Boylan, 2011 ). Therefore, in supply chains, information sharing is usually encouraged by using appropriately designed contracts (Cachon and Lariviere, 2001 ). This idea of using contracts to obligate the individuals may directly be translated to our present scenario. However, this paper does not attempt to discuss such energy policy in details.  Conflict of Intrest Author declare no conflict of interest.   Acknowledgment This work is partially supported under the A∗ STAR  TSRP fund 1424200021  and Antuit–SIMTech Supply Chain Analytics Lab. The authors would like to thank Jan Kleissl and Xiaohui Zhong for their communication during the preparation of this paper.  Appendix A PV power output time series clustering Among the (approximately) 6000 simulated PV systems in the SPDIS dataset, 405 are located in California. These PV systems can either have a fixed orientation or use tracking devices (Hummon et al., 2012 ). As the power output time series of these two types of PV systems are significantly different, we develop a simple time series clustering technique in this appendix, so that those tracking plants can be excluded during the forecasting exercise. By visual inspection, the type of PV systems can be easily identified; the power output time series transients of systems with tracking devices have a “flat top” (see Fig. 3 in, Baltas et al., 1986 ). However, it is impractical to visually inspect the transients of a large number of PV systems. In a recent paper by Hyndman et al. (2015) , a similar problem was described, namely, when a very large amount of time series is collected, it is difficult to spot the “unusual” time series. Hyndman et al. (2015)  noted that time series can be represented by features (such as trend, linearity and lumpiness); as feature space is almost always smaller than the original dataset, it is more amenable to detect time series anomalies in the feature space. In this paper, we use time series features to cluster the PV systems. It is known, a posteriori , that during the mid-day period, the time series of the two types of systems are most different. Therefore, only data points between 9:00 am and 2:00 pm from the original hourly time series (from the day-ahead forecasts files) are selected. To remove the data points with low power output values, which will add noise to the time series clustering, only the data points above the 50 percentile are chosen. Examples of the truncated time series are plotted in Fig. A.5  ; a total of 1095 (6 h times 365 days divided by 2) data points remain in each time series. Subsequently, these truncated time series are converted to the 13 features given in (Hyndman et al., 2015 ). In addition, another feature, namely, the sum of the normalized power output, is added into the feature space. The feature matrix is therefore 405 (number of time series) by 14 (features) in size. Using the k-means (2 centers, 25 random sets of initial centers) with principal component analysis on this feature matrix, the time series are clustered as depicted in Fig. A.6  . The figure is known as a biplot (Gabriel, 1971 ). It can be seen that the two types of PV systems are linearly separable in the low-dimension space. The total number of PV systems with a fixed orientation is 318.  Appendix B Supplementary material Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.solener.2017.02.010 .  Supplementary material Supplementary data 1       
